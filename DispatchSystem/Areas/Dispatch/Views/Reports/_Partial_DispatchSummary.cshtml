@using System.Globalization;
@model (string Report_Type, string PageTitle, string PlantName, dynamic objFilter, List<MDA_Status> List, bool isPrint)

@if (Model.Report_Type == "DS_BAT")
{
	if (Model.objFilter.DataType == "IS")
	{
		ViewData["Title"] = "Batch Wise Is-Stock Summary Report";
	}
	else
	{
		ViewData["Title"] = "Batch Wise Dispatch Summary Report";
	}
}
else if (Model.Report_Type == "DS")
{
	ViewData["Title"] = "MDA Dispatch Summary Report";
}
else
{
	ViewData["Title"] = "MDA Dispatch Summary Count Report";
}

@if (Model.isPrint == true)
{
	Layout = "~/Views/Shared/_Layout_Print.cshtml";
}

@if (Model.isPrint == true)
{
	<div class="row col-12 mb-3">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-12" style="text-align:center;">
					<h2 class="font-weight-bold">@(!string.IsNullOrEmpty(Model.PlantName) ? Model.PlantName : "IFFCO NANO FERTILIZER PLANT - KALOL") </h2>
				</div>
				<br />
				<div class="col-sm-12" style="text-align:center;">
					@if (Model.Report_Type == "DS_BAT")
					{
						if (Model.objFilter.DataType == "IS")
						{
							<h3 class="font-weight-bold">Batch Wise Is-Stock Summary Report</h3>
						}
						else
						{
							<h3 class="font-weight-bold">Batch Wise Dispatch Summary Report</h3>
						}
					}
					else if (Model.Report_Type == "DS")
					{
						<h3 class="font-weight-bold">MDA Dispatch Summary Report</h3>
					}
					else
					{
						<h3 class="font-weight-bold">MDA Dispatch Count Summary Report</h3>
					}
				</div>
				@if (!string.IsNullOrEmpty(Model.PageTitle))
				{
					<br />
					<div class="col-sm-12" style="text-align:center;">
						<h4>@Model.PageTitle</h4>
					</div>
				}
				<br />
				<div class="col-sm-12" style="text-align:right;">
					<h5 class="font-weight-bold"><b>Printed on : @DateTime.Now.ToString("dd/MM/yyyy hh:mm tt").Replace("-", "/")</b></h5>
				</div>
			</div>
		</div>
	</div>
}
else
{
	<div class="form-group row mb-3">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-12" style="text-align:center;">
					@if (Model.Report_Type == "DS_BAT")
					{
						if (Model.objFilter.DataType == "IS")
						{
							<h2 class="font-weight-bold" id="lableReportTitle"><b>Batch Wise Is-Stock Summary Report</b></h2>
						}
						else
						{
							<h2 class="font-weight-bold" id="lableReportTitle"><b>Batch Wise Dispatch Summary Report</b></h2>
						}
					}
					else if (Model.Report_Type == "DS")
					{
						<h2 class="font-weight-bold" id="lableReportTitle"><b>MDA Dispatch Summary Report</b></h2>
					}
					else
					{
						<h2 class="font-weight-bold" id="lableReportTitle"><b>MDA Dispatch Count Summary Report</b></h2>
					}
				</div>
				<br />
			</div>
		</div>
	</div>

	<div class="form-group row mt-2">
		@if (Model.Report_Type == "DS_BAT")
		{
			<button class="btn btn-info mr-2" onclick="fnPrint_Report('@(Url.Action("GetData_DispatchSummary_BatchWise", "Reports"))?Report_Type=@(Model.Report_Type)&FromDate=@(Model.objFilter.FromDate)&ToDate=@(Model.objFilter.ToDate)&DataType=@(Model.objFilter.DataType)&isPrint=true')">Print</button>
		}
		else
		{
			<button class="btn btn-info mr-2" onclick="fnPrint_Report('@(Url.Action("GetData_DispatchSummary", "Reports"))?Report_Type=@(Model.Report_Type)&MDA_No=@(Model.objFilter.MDA_No)&Truck_No=@(Model.objFilter.Truck_No)&PartyName=@(Model.objFilter.PartyName)&FromDate=@(Model.objFilter.FromDate)&ToDate=@(Model.objFilter.ToDate)&Destination=@(Model.objFilter.Destination)&isPrint=true')">Print</button>
		}
		<button class="btn btn-success btn-md pull-right mr-2" onclick="fnExport_Excel('@Model.Report_Type')">Export</button>
	</div>
}

<div class="row col-12 mt-3 table-responsive w-100">
	<table id="tableReport" class="table table-bordered table-striped w-100 display">
		@if (Model.Report_Type == "DS")
		{
			<thead>
				<tr>
					<th hidden>#</th>
					<th>MDA No.</th>
					<th>Destination</th>
					@*<th>Transaction Type</th>*@
					<th>Product Code</th>
					<th>Product Name</th>
					<th>Dispatch DateTime</th>
					<th>Dispatch From Type</th>
					<th>Dispatch From Code & Name</th>
					<th>Dispatch To Type</th>
					<th>Dispatch To Code & Name</th>
					@* <th>Dispatched Qty (KL)</th> *@
					<th>Dispatched Qty (Shipper)</th>
					<th>Dispatched Qty (Bottles)</th>
				</tr>
			</thead>
			<tbody>
				@if (Model.List != null && Model.List.Count() > 0)
				{
					@foreach (var item in Model.List.OrderBy(x => x.SrNo).ToList())
					{
						<tr>
							<td hidden>@item.SrNo</td>
							<td>@item.MDANo</td>
							<td>@item.Destination</td>
							@*<td>@item.TransactionType</td>*@
							<td>@item.ArticleCode</td>
							<td>@item.ArticleName</td>
							<td>@item.DispatchDateTime</td>
							<td>@item.DispatchFromType</td>
							<td>@item.DispatchFromCodeAndName</td>
							<td>@item.DispatchToType</td>
							<td>@item.DispatchToCodeAndName</td>
							@* <td>@item.DispatchedQtyKL</td> *@
							<td>@item.DispatchedQtyShipper</td>
							<td>@item.DispatchedQtyUnits</td>
						</tr>
					}
				}
			</tbody>
		}
		else if (Model.Report_Type == "DS_MDA")
		{
			<thead>
				<tr>
					<th hidden>#</th>
					<th>MDA No.</th>
					<th>MDA Date</th>
					<th>BatchNo(Shipper Qty)</th>
					<th>MFG Date</th>
					<th>Truck No</th>
					<th>Total Shipper Qty</th>
					<th>Bottle Qty</th>
					<th>Loading Bay</th>
					<th>Product</th>
					<th>Customer Name</th>
					<th>Destination</th>
					@* <th>Address</th> *@
				</tr>
			</thead>
			<tbody>
				@if (Model.List != null && Model.List.Count() > 0)
				{
					@foreach (var item in Model.List.OrderBy(x => x.SrNo).ToList())
					{
						<tr>
							<td hidden>@item.SrNo</td>
							<td>@item.MDANo</td>
							<td>@item.MDAReceiveDate</td>
							<td>@item.BatchNo</td>
							<td>@item.ManufacturingDate</td>
							<td>@item.TruckNo</td>
							<td>@item.MDAQty</td>
							<td>@item.DispatchedQtyKL</td>
							<td>@item.LoadingBayPrintedTo</td>
							<td>@item.ArticleName</td>
							<td>@item.CustomerName</td>
							<td>@item.Destination</td>
							@* <td>@item.Reason</td> *@
						</tr>
					}
				}
			</tbody>
		}
		else if (Model.Report_Type == "DS_COUNT")
		{
			<thead>
				<tr>
					<th hidden>#</th>
					<th>MDA No.</th>
					<th>MDA Date</th>
					<th>Truck No</th>
					<th>MDA Qty (Shippers)</th>
					<th>MDA Qty (Bottle)</th>
					<th>Product Code</th>
					<th>Product Name</th>
					<th>Destination</th>
				</tr>
			</thead>
			<tbody>
				@if (Model.List != null && Model.List.Count() > 0)
				{
					@foreach (var item in Model.List.OrderBy(x => x.MDANo).ToList())
					{
						<tr>
							<td hidden>@item.SrNo</td>
							<td>@item.MDANo</td>
							<td>@item.MDAReceiveDate</td>
							<td>@item.TruckNo</td>
							<td>@item.DispatchedQtyShipper</td>
							<td>@item.DispatchedQtyUnits</td>
							<td>@item.ArticleCode</td>
							<td>@item.ArticleName</td>
							<td>@item.Destination</td>
						</tr>
					}
				}
			</tbody>
		}
		else if (Model.Report_Type == "DS_BAT")
		{
			if (Model.objFilter.DataType == "DI")
			{
				var listBatch = Model.List.Where(x => !string.IsNullOrEmpty(x.MDANo)).GroupBy(x => new { x.SrNo, x.BatchNo, x.ManufacturingDate })
				.Select(g => new { SrNo = g.Key.SrNo, BatchNo = g.Key.BatchNo, ManufacturingDate = g.Key.ManufacturingDate, Items = g.ToList() }).ToList();

				@foreach (var batch in listBatch.OrderBy(x => Convert.ToInt32(x.SrNo)))
				{
					<thead>
						<tr style="border-bottom: 2px solid #dee2e6;">
							<th width="5%" class="text-center">@batch.SrNo</th>
							<th colspan="6">Batch No. : @batch.BatchNo &nbsp; &nbsp; Batch Date : @batch.ManufacturingDate</th>
							<th width="0%" hidden>&nbsp;</th>
						</tr>
						<tr>
							<th width="5%" class="text-center">#</th>
							<th width="10%" class="text-center">MDA No.</th>
							<th width="10%" class="text-center">MDA Date</th>
							<th class="text-center">Location</th>
							<th class="text-center">Society Name</th>
							<th width="10%" class="text-center">No. of Shipper</th>
							<th width="10%" class="text-center">No. of Bottle</th>
							<th width="0%" hidden>&nbsp;</th>
						</tr>
					</thead>
					<tbody>
						@if (batch.Items != null && batch.Items.Count() > 0)
						{
							@foreach (var item in batch.Items.OrderBy(x => Convert.ToInt32(x.RFID)).ToList())
							{
								<tr>
									<td class="text-center">@(Convert.ToInt32(item.RFID))</td>
									<td width="10%" class="text-center">@item.MDANo</td>
									<td width="10%" class="text-center">@item.MDAReceiveDate</td>
									<td class="text-center">@item.Destination</td>
									<td class="text-center">@item.CustomerName</td>
									<td width="10%" class="text-center">@item.MDAQty</td>
									<td width="10%" class="text-center">@item.LoadedQty</td>
									<th width="0%" hidden>&nbsp;</th>
								</tr>
							}
							<tr>
								<th colspan="7">&nbsp;</th>
								<th width="0%" hidden>&nbsp;</th>
							</tr>
						}
					</tbody>
				}
			}
			else
			{
				<thead>
					<tr>
						<th>#</th>
						<th class="text-center">Batch No.</th>
						<th class="text-center">Batch Date</th>
						<th class="text-center">Expiry Date</th>
						<th class="text-center">No. of Shipper</th>
						<th class="text-center">No. of Bottle</th>
						<th width="0%" hidden>&nbsp;</th>
					</tr>
				</thead>
				<tbody>
					@if (Model.List != null && Model.List.Count() > 0)
					{
						var listBatch = Model.List.Where(x => string.IsNullOrEmpty(x.MDANo)).ToList();

						@foreach (var item in listBatch.OrderBy(x => Convert.ToInt32(x.SrNo)))
						{
							<tr>
								<td>@item.SrNo</td>
								<td class="text-center">@item.BatchNo</td>
								<td class="text-center">@item.ManufacturingDate</td>
								<td class="text-center">@item.ExpiryDate</td>
								<td class="text-center">@item.MDAQty</td>
								<td class="text-center">@item.LoadedQty</td>
								<th width="0%" hidden>&nbsp;</th>
							</tr>
						}
					}
				</tbody>
			}
		}
	</table>
</div>


@if (Model.isPrint == false)
{
	<div class="row col-12 mb-3 d-none file-export-header">
		<div class="container-fluid">
			<div class="row mb-2">
				<div class="col-sm-12" style="text-align:center;">
					<h2 class="font-weight-bold">@(!string.IsNullOrEmpty(Model.PlantName) ? Model.PlantName : "IFFCO NANO FERTILIZER PLANT - KALOL") </h2>
				</div>
				<br />
				<div class="col-sm-12" style="text-align:center;">
					@if (Model.Report_Type == "DS_BAT")
					{
						if (Model.objFilter.DataType == "IS")
						{
							<h3 class="font-weight-bold">Batch Wise Is-Stock Summary Report</h3>
						}
						else
						{
							<h3 class="font-weight-bold">Batch Wise Dispatch Summary Report</h3>
						}
					}
					else if (Model.Report_Type == "DS")
					{
						<h3 class="font-weight-bold">MDA Dispatch Summary Report</h3>
					}
					else
					{
						<h3 class="font-weight-bold">MDA Dispatch Count Summary Report</h3>
					}
				</div>
				@if (!string.IsNullOrEmpty(Model.PageTitle))
				{
					<br />
					<div class="col-sm-12" style="text-align:center;">
						<h4>@Model.PageTitle</h4>
					</div>
				}
				<br />
				<div class="col-sm-12" style="text-align:right;">
					<h5 class="font-weight-bold"><b>Printed on : @DateTime.Now.ToString("dd/MM/yyyy hh:mm tt").Replace("-", "/")</b></h5>
				</div>
			</div>
		</div>
	</div>
}